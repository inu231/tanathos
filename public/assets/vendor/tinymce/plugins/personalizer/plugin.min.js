tinymce.PluginManager.add('personalizer', function(editor, url) {

    var tags = [{ label : true, title : 'Informações do assinante' },{ title : 'Assinatura IP ', tags : '%Subscriber:SubscriptionIP%' },{ title : 'Bounce Type ', tags : '%Subscriber:BounceType%' },{ title : 'Data de Subscrição', tags : '%Subscriber:SubscriptionDate%' },{ title : 'Data do cancelamento da inscrição', tags : '%Subscriber:UnsubscriptionDate%' },{ title : 'Endereço de e-mail ', tags : '%Subscriber:EmailAddress%' },{ title : 'ID Assinante ', tags : '%Subscriber:SubscriberID%' },{ title : 'IP do cancelamento da inscrição', tags : '%Subscriber:UnsubscriptionIP%' },{ title : 'Opt-In ', tags : '%Subscriber:OptInDate%' },{ title : 'Status da assinatura', tags : '%Subscriber:SubscriptionStatus%' },{ title : 'Personalização Condicional ', tags : '[IF:condition1<>condition2] true content block [ELSE] false content block [ENDIF]' },{ label : true, title : 'Os links de campanha' },{ title : 'Forward To Friend Link', tags : '%Link:Forward%' },{ title : 'View In Web Browser Link', tags : '%Link:WebBrowser%' },{ title : 'Report Abuse Link', tags : '%Link:ReportAbuse%' },{ title : 'Twitter Share Link', tags : '%Link:SocialShare:Twitter%' },{ title : 'Facebook Like Link', tags : '%Link:SocialShare:Facebook%' },{ title : 'Conteúdo remoto', tags : '%RemoteContent=http://%' },{ label : true, title : 'Lista de ligações' },{ title : 'Unsubscription Link', tags : '%Link:Unsubscribe%' },{ title : 'Subscriber Area Link', tags : '%Link:SubscriberArea%' },{ label : true, title : 'Informações Lista' },{ title : 'Lista de ID', tags : '%List:ID%' },{ title : 'Lista de nomes ', tags : '%List:Name%' },{ label : true, title : 'Informação do usuário' },{ title : 'Nome', tags : '%User:FirstName%' },{ title : 'Apelido', tags : '%User:LastName%' },{ title : 'Endereço de e-mail ', tags : '%User:EmailAddress%' },{ title : 'Nome da Empresa', tags : '%User:CompanyName%' },{ title : 'URL do site', tags : '%User:Website%' },{ title : 'Rua', tags : '%User:Street%' },{ title : 'Cidade', tags : '%User:City%' },{ title : 'Estado', tags : '%User:State%' },{ title : 'CEP', tags : '%User:Zip%' },{ title : 'País ', tags : '%User:Country%' },{ title : 'Telefone', tags : '%User:Phone%' },{ title : 'Fax', tags : '%User:Fax%' },{ title : 'Fuso Horário', tags : '%User:TimeZone%' },{ label : true, title : 'Outros' },{ title : 'Data de entrega e-mail ', tags : '%Date=...%' }];

    editor.addButton('personalizer', {
        type: 'panelbutton',
        text: 'Personalizar',
        tooltip: 'Personalizar',
        panel: {
            role: 'application',
            autohide: true,
            html: getHtml,
            onclick: function(e) {
                var linkElm = editor.dom.getParent(e.target, 'li');

                if (linkElm) {
                    editor.insertContent(
                        linkElm.getAttribute('data-mce-tag')
                    );

                    this.hide();
                }
            }
        }
    });

    function getHtml() {
        var listHtml;

        listHtml = '<ul role="list" class="mce-menu">';

        tinymce.each(tags, function(row) {
            if (row.tags) {
                listHtml += '<li class="mce-menu-item" data-mce-tag="'+row.tags+'">'+row.title+'</li>';
            }
        });

        listHtml += '</ul>';

        return listHtml;
    }

});
